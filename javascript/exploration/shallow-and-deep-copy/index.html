<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>深入理解 JavaScript 对象和数组拷贝 | The Full Stack Way</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.4.0">
    
    
    <link rel="preload" href="/the-full-stack-way/assets/css/0.styles.8a3e2982.css" as="style"><link rel="preload" href="/the-full-stack-way/assets/js/app.f9357a35.js" as="script"><link rel="preload" href="/the-full-stack-way/assets/js/2.b1f3daca.js" as="script"><link rel="preload" href="/the-full-stack-way/assets/js/54.0686f57d.js" as="script"><link rel="prefetch" href="/the-full-stack-way/assets/js/10.6c889a9a.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/100.f90f9973.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/101.3987eaff.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/102.3cf9c810.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/103.d15f6c9b.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/104.e466044e.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/105.20d1908f.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/106.5b39d446.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/107.fc8b496e.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/108.fb9f91e0.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/109.6268b8ea.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/11.7c8389bb.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/110.2c3d6f59.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/111.96ee1a2b.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/112.9128d190.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/113.15790c0b.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/114.31bfc42a.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/115.f4c92fe6.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/12.75a719dc.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/13.a8b6377a.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/14.6420038a.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/15.d1f13c21.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/16.00e6243c.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/17.35ac18ce.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/18.3c237a31.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/19.aabf4c6a.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/20.0986a2b7.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/21.e8c70f8b.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/22.741f5d73.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/23.ed34adbb.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/24.d62d4cc3.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/25.1b17f8e9.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/26.1ed597e5.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/27.ce30edde.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/28.139bf76b.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/29.f8ad8e1f.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/3.3f49bff2.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/30.a52c8169.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/31.2141d424.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/32.1b5b3ff5.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/33.5a737053.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/34.f26c31a5.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/35.915f7f61.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/36.59b2dcd7.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/37.c31c7f93.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/38.633d2a13.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/39.b694f183.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/4.0f03aa05.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/40.49ff0394.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/41.cde8809c.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/42.f9778ad2.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/43.41892a84.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/44.e7e8fe4e.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/45.3058bbf7.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/46.6be21497.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/47.0c007000.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/48.7e5b82ca.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/49.533c0c4b.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/5.447297a4.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/50.4d464cdb.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/51.96f40432.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/52.16b3b204.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/53.1b544a9a.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/55.fe2e21a5.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/56.64e0245a.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/57.1432a0f7.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/58.ef81beae.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/59.84426fc3.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/6.44cf4d9b.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/60.4fb23994.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/61.e19fe6bc.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/62.a517d9ff.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/63.82c9e9da.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/64.ddecf4eb.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/65.e96d2637.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/66.19075ca9.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/67.74248cbc.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/68.28058192.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/69.e7114145.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/7.4daee758.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/70.5fa684c4.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/71.077a147c.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/72.dcd1ef5d.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/73.e738e0f0.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/74.40c49915.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/75.b34fd6b0.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/76.89eca840.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/77.e0dcba02.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/78.eb97c178.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/79.39e665e3.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/8.51b0433f.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/80.f3777ec9.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/81.4ca8fadf.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/82.015a3b4f.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/83.1df7d2da.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/84.36b4c86e.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/85.7bd7d160.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/86.0a205a19.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/87.3d08f039.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/88.e152f51c.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/89.02bed3c5.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/9.80cef23a.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/90.df6e336b.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/91.a843ae09.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/92.c5b0c9f9.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/93.9f096ef1.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/94.50f0152f.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/95.ef3c1556.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/96.615d21c1.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/97.7867466b.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/98.3a9d0ecd.js"><link rel="prefetch" href="/the-full-stack-way/assets/js/99.cece1fc3.js">
    <link rel="stylesheet" href="/the-full-stack-way/assets/css/0.styles.8a3e2982.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/the-full-stack-way/" class="home-link router-link-active"><!----> <span class="site-name">The Full Stack Way</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/the-full-stack-way/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><span class="title">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/the-full-stack-way/data-structure-and-algorithms/" class="nav-link">
  数据结构与算法
</a></li><li class="dropdown-item"><!----> <a href="/the-full-stack-way/operating-system/" class="nav-link">
  操作系统
</a></li><li class="dropdown-item"><!----> <a href="/the-full-stack-way/network/" class="nav-link">
  网络
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Web 前端" class="dropdown-title"><span class="title">Web 前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/the-full-stack-way/html&amp;css/" class="nav-link">
  HTML&amp;CSS
</a></li><li class="dropdown-item"><!----> <a href="/the-full-stack-way/javascript/" class="nav-link router-link-active">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/the-full-stack-way/engineering/" class="nav-link">
  工程化
</a></li><li class="dropdown-item"><!----> <a href="/the-full-stack-way/react/" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/the-full-stack-way/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/the-full-stack-way/mini-program/" class="nav-link">
  小程序
</a></li></ul></div></div><div class="nav-item"><a href="/the-full-stack-way/node/" class="nav-link">
  Node
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/the-full-stack-way/redis/" class="nav-link">
  Redis
</a></li></ul></div></div><div class="nav-item"><a href="/the-full-stack-way/docker/" class="nav-link">
  Docker
</a></div><div class="nav-item"><a href="/the-full-stack-way/tools/" class="nav-link">
  工具
</a></div><div class="nav-item"><a href="https://github.com/chhpt/the-full-stack-way" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/the-full-stack-way/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><span class="title">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/the-full-stack-way/data-structure-and-algorithms/" class="nav-link">
  数据结构与算法
</a></li><li class="dropdown-item"><!----> <a href="/the-full-stack-way/operating-system/" class="nav-link">
  操作系统
</a></li><li class="dropdown-item"><!----> <a href="/the-full-stack-way/network/" class="nav-link">
  网络
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Web 前端" class="dropdown-title"><span class="title">Web 前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/the-full-stack-way/html&amp;css/" class="nav-link">
  HTML&amp;CSS
</a></li><li class="dropdown-item"><!----> <a href="/the-full-stack-way/javascript/" class="nav-link router-link-active">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/the-full-stack-way/engineering/" class="nav-link">
  工程化
</a></li><li class="dropdown-item"><!----> <a href="/the-full-stack-way/react/" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/the-full-stack-way/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/the-full-stack-way/mini-program/" class="nav-link">
  小程序
</a></li></ul></div></div><div class="nav-item"><a href="/the-full-stack-way/node/" class="nav-link">
  Node
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/the-full-stack-way/redis/" class="nav-link">
  Redis
</a></li></ul></div></div><div class="nav-item"><a href="/the-full-stack-way/docker/" class="nav-link">
  Docker
</a></div><div class="nav-item"><a href="/the-full-stack-way/tools/" class="nav-link">
  工具
</a></div><div class="nav-item"><a href="https://github.com/chhpt/the-full-stack-way" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/the-full-stack-way/javascript/" class="sidebar-link">JavaScript</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/#javascript-延迟加载" class="sidebar-link">JavaScript 延迟加载</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/#for-in-和-for-of" class="sidebar-link">for...in 和 for...of</a></li></ul></li><li><a href="/the-full-stack-way/javascript/foundation.html" class="sidebar-link">JavaScript 基础语法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/foundation.html#javascript-数据类型" class="sidebar-link">JavaScript 数据类型</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/foundation.html#null-和-undefined" class="sidebar-link">null 和 undefined</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/foundation.html#基本类型和引用数据类型" class="sidebar-link">基本类型和引用数据类型</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/foundation.html#变量声明提升" class="sidebar-link">变量声明提升</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/foundation.html#和" class="sidebar-link">== 和 ===</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/foundation.html#宿主对象和原生对象" class="sidebar-link">宿主对象和原生对象</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/foundation.html#let-和-var" class="sidebar-link">let 和 var</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/foundation.html#判断变量是否数组类型" class="sidebar-link">判断变量是否数组类型</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/foundation.html#object-is-与-，" class="sidebar-link">Object.is() 与 “===”，“==”</a></li></ul></li><li><a href="/the-full-stack-way/javascript/function.html" class="sidebar-link">JavaScript 函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/function.html#arguments" class="sidebar-link">arguments</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/function.html#this" class="sidebar-link">this</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/function.html#闭包" class="sidebar-link">闭包</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/function.html#数组的原生方法" class="sidebar-link">数组的原生方法</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/function.html#apply、call、bind" class="sidebar-link">apply、call、bind</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/function.html#数组去重的方法" class="sidebar-link">数组去重的方法</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/function.html#获取数组最小值" class="sidebar-link">获取数组最小值</a></li></ul></li><li><a href="/the-full-stack-way/javascript/object.html" class="sidebar-link">JavaScript 对象</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/object.html#内置对象" class="sidebar-link">内置对象</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/object.html#创建对象" class="sidebar-link">创建对象</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/object.html#typeof" class="sidebar-link">typeof</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/object.html#原型与原型链" class="sidebar-link">原型与原型链</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/object.html#new-操作符" class="sidebar-link">new 操作符</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/object.html#对象继承" class="sidebar-link">对象继承</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/object.html#对象的复制" class="sidebar-link">对象的复制</a></li></ul></li><li><a href="/the-full-stack-way/javascript/performance.html" class="sidebar-link">一、测试工具</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/performance.html#性能分析" class="sidebar-link">性能分析</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/performance.html#网络分析" class="sidebar-link">网络分析</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/performance.html#脚本的位置" class="sidebar-link">脚本的位置</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/performance.html#组织脚本" class="sidebar-link">组织脚本</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/performance.html#无阻塞的脚本" class="sidebar-link">无阻塞的脚本</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/performance.html#访问与修改" class="sidebar-link">访问与修改</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/performance.html#html-集合" class="sidebar-link">HTML 集合</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/performance.html#获取-dom-元素" class="sidebar-link">获取 DOM 元素</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/performance.html#重绘与重排" class="sidebar-link">重绘与重排</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/performance.html#事件委托" class="sidebar-link">事件委托</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/performance.html#循环" class="sidebar-link">循环</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/performance.html#递归" class="sidebar-link">递归</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/performance.html#请求数据" class="sidebar-link">请求数据</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/performance.html#发送数据" class="sidebar-link">发送数据</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/performance.html#数据格式" class="sidebar-link">数据格式</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/performance.html#性能优化" class="sidebar-link">性能优化</a></li></ul></li><li><a href="/the-full-stack-way/javascript/theory.html" class="sidebar-link">JavaScript 原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/theory.html#内存回收机制" class="sidebar-link">内存回收机制</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/theory.html#事件执行机制" class="sidebar-link">事件执行机制</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/theory.html#执行环境和作用域链" class="sidebar-link">执行环境和作用域链</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/theory.html#jit-just-in-time-compiler" class="sidebar-link">JIT (just-in-time) Compiler</a></li></ul></li><li><a href="/the-full-stack-way/javascript/test.html" class="sidebar-link">测试</a></li><li><a href="/the-full-stack-way/javascript/patterns.html" class="sidebar-link">JavaScript 设计模式</a></li><li><a href="/the-full-stack-way/javascript/cors.html" class="sidebar-link">跨域请求</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/cors.html#什么是跨域" class="sidebar-link">什么是跨域</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/cors.html#同源策略限制了什么" class="sidebar-link">同源策略限制了什么</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/cors.html#实现跨域的方法" class="sidebar-link">实现跨域的方法</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>正则表达式</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/the-full-stack-way/javascript/reg/" class="sidebar-link">正则表达式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/reg/#元字符" class="sidebar-link">元字符</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/reg/#重复匹配" class="sidebar-link">重复匹配</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/reg/#贪婪与懒惰" class="sidebar-link">贪婪与懒惰</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/reg/#位置匹配" class="sidebar-link">位置匹配</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/reg/#子表达式" class="sidebar-link">子表达式</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/reg/#分枝条件" class="sidebar-link">分枝条件</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/reg/#向前查找" class="sidebar-link">向前查找</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/reg/#参考文章" class="sidebar-link">参考文章</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>ES6</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/the-full-stack-way/javascript/es6/" class="sidebar-link">ECMAScript 6</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/es6/#es6-中的新特性" class="sidebar-link">ES6 中的新特性</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/es6/#es6-的类与继承" class="sidebar-link">ES6 的类与继承</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/es6/#promise" class="sidebar-link">Promise</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/es6/#proxy" class="sidebar-link">Proxy</a></li></ul></li><li><a href="/the-full-stack-way/javascript/es6/dev.html" class="sidebar-link">ES6 开发环境配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/es6/dev.html#环境支持" class="sidebar-link">环境支持</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/es6/dev.html#转码" class="sidebar-link">转码</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>TypeScript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/the-full-stack-way/javascript/typescript/" class="sidebar-link">TypeScript</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/typescript/#typescript-是什么" class="sidebar-link">TypeScript 是什么</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/typescript/#why-typescript" class="sidebar-link">Why TypeScript</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/typescript/#typescript-能做什么" class="sidebar-link">TypeScript 能做什么</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/typescript/#相关文章" class="sidebar-link">相关文章</a></li></ul></li><li><a href="/the-full-stack-way/javascript/typescript/doc.html" class="sidebar-link">环境声明</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/typescript/doc.html#环境声明" class="sidebar-link">环境声明</a></li><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/typescript/doc.html#接口" class="sidebar-link">接口</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>小技巧</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/the-full-stack-way/javascript/tips/" class="sidebar-link">JavaScript 小技巧</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/the-full-stack-way/javascript/tips/#json-stringify" class="sidebar-link">JSON.stringify</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="深入理解-javascript-对象和数组拷贝"><a href="#深入理解-javascript-对象和数组拷贝" class="header-anchor">#</a> 深入理解 JavaScript 对象和数组拷贝</h1> <h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>本文要解决的问题：</p> <ul><li>为什么会有深拷贝（deep clone）和浅拷贝（shallow clone）的存在</li> <li>理解 JavaScript 中深拷贝和浅拷贝的区别</li> <li>JavaScript 拷贝对象的注意事项</li> <li>JavaScript 拷贝对象和数组的实现方法</li></ul> <p>部分代码可在这里找到：<a href="https://github.com/chhpt/JavaScript-Exploration/tree/master/shallow_and_deep_copy" target="_blank" rel="noopener noreferrer">Github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。如果发现错误，欢迎指出。</p> <h2 id="一，-理解问题原因所在"><a href="#一，-理解问题原因所在" class="header-anchor">#</a> 一， 理解问题原因所在</h2> <p>JavaScript 中的数据类型可以分为两种：基本类型值（Number, Boolean, String, NULL, Undefined）和引用类型值（Array, Object, Date, RegExp, Function)。 基本类型值指的是简单的数据段，而引用类型值指那些可能由多个值构成的对象。</p> <p><strong>基本数据类型是按值访问的</strong>，因为可以直接操作保存在变量中的实际的值。引用类型的值是保存在内存中的对象，与其他语言不同，JavaScript 不允许直接访问内存中的位置，也就是说不能直接操作对象的内存空间。在操作对象时，实际上是在<strong>操作对象的引用</strong>而不是实际的对象。 为此，引用类型的值是按引用访问的。</p> <p>除了保存的方式不同之外，在从一个变量向另一个变量复制基本类型值和引用类型值时，也存在不同：</p> <ul><li>如果从一个变量向另一个变量复制基本类型的值，会在变量对象上创建一个新值，然后把该值复制到为新变量分配的位置上。</li> <li>当从一个变量向另一个变量复制引用类型的值时，同样也会将存储在变量对象中的值复制一份放到为新变量分配的空间中。不同的是，这个值的副本实际上是一个指针，而这个指针指向存储在堆中的一个对象。复制操作结束后，两个变量实际上将引用同一个对象。因此，改变其中一个变量，就会影响另一个变量。</li></ul> <p>看下面的代码：</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token comment">// 基本类型值复制</span>
<span class="token keyword">var</span> string1 <span class="token operator">=</span> <span class="token string">'base type'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> string2 <span class="token operator">=</span> string1<span class="token punctuation">;</span>

<span class="token comment">// 引用类型值复制</span>
<span class="token keyword">var</span> object1 <span class="token operator">=</span> <span class="token punctuation">{</span>a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> object2 <span class="token operator">=</span> object1<span class="token punctuation">;</span>
</code></pre></div><p>下图可以表示两种类型的变量的复制结果：</p> <p><img src="http://markdown-1252710547.coscd.myqcloud.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202017-10-31%20%E4%B8%8B%E5%8D%8817.21.50%20%E4%B8%8B%E5%8D%88.png" alt=""></p> <p>至此，我们应该理解：在 JavaScript 中直接复制对象实际上是对引用的复制，会导致两个变量引用同一个对象，对任一变量的修改都会反映到另一个变量上，这是一切问题的原因所在。</p> <h2 id="二，-深拷贝和浅拷贝的区别"><a href="#二，-深拷贝和浅拷贝的区别" class="header-anchor">#</a> 二， 深拷贝和浅拷贝的区别</h2> <p>理解了 JavaScript 中拷贝对象的问题后，我们就可以讲讲深拷贝和浅拷贝的区别了。考虑这种情况，你需要复制一个对象，这个对象的某个属性还是一个对象，比如这样：</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> object1 <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  obj<span class="token operator">:</span> <span class="token punctuation">{</span>
    b<span class="token operator">:</span> <span class="token string">'string'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="浅拷贝"><a href="#浅拷贝" class="header-anchor">#</a> 浅拷贝</h3> <p><code>浅拷贝</code>存在两种情况：</p> <ul><li>直接拷贝对象，也就是拷贝引用，两个变量<code>object1</code> 和 <code>object2</code> 之间还是会相互影响。</li> <li>只是简单的拷贝对象的第一层属性，基本类型值不再相互影响，但是对其内部的引用类型值，拷贝的任然是是其引用，内部的引用类型值还是会相互影响。</li></ul> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token comment">// 最简单的浅拷贝</span>
<span class="token keyword">var</span> object2 <span class="token operator">=</span> object1<span class="token punctuation">;</span>

<span class="token comment">// 拷贝第一层属性</span>
<span class="token keyword">function</span> <span class="token function">shallowClone</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>source <span class="token operator">||</span> <span class="token keyword">typeof</span> source <span class="token operator">!==</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> targetObj <span class="token operator">=</span> source<span class="token punctuation">.</span>constructor <span class="token operator">===</span> Array <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> keys <span class="token keyword">in</span> source<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>source<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>keys<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 简单的拷贝属性</span>
            targetObj<span class="token punctuation">[</span>keys<span class="token punctuation">]</span> <span class="token operator">=</span> source<span class="token punctuation">[</span>keys<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> targetObj<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> object3 <span class="token operator">=</span> <span class="token function">shallowClone</span><span class="token punctuation">(</span>object1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 改变原对象的属性</span>
object1<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
object1<span class="token punctuation">.</span>obj<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token string">'newString'</span><span class="token punctuation">;</span>
<span class="token comment">// 比较</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>object2<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>object2<span class="token punctuation">.</span>obj<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'newString'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>object3<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>object3<span class="token punctuation">.</span>obj<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'newString'</span>
</code></pre></div><p>浅拷贝存在许多问题，需要我们注意：</p> <ul><li>只能拷贝可枚举的属性。</li> <li>所生成的<code>拷贝对象</code>的原型与<code>原对象</code>的原型不同，拷贝对象只是 Object 的一个实例。</li> <li>原对象从它的原型继承的属性也会被拷贝到新对象中，就像是原对象的属性一样，无法区分。</li> <li>属性的描述符（descriptor）无法被复制，一个只读的属性在拷贝对象中可能会是可写的。</li> <li>如果属性是对象的话，原对象的属性会与拷贝对象的属性会指向一个对象，会彼此影响。</li></ul> <p>不能理解这些概念？可以看看下面的代码：</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'parent'</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">Child</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'child'</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token class-name">Child</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> child1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 更改 child1 的 name 属性的描述符</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>child1<span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  writable<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  value<span class="token operator">:</span> <span class="token string">'Mike'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 拷贝对象</span>
<span class="token keyword">var</span> child2 <span class="token operator">=</span> <span class="token function">shallowClone</span><span class="token punctuation">(</span>child1<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Object {value: &quot;Nicholas&quot;, writable: false, enumerable: true, configurable: true}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyDescriptor</span><span class="token punctuation">(</span>child1<span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 这里新对象的 name 属性的描述符已经发生了变化</span>
<span class="token comment">// Object {value: &quot;Nicholas&quot;, writable: true, enumerable: true, configurable: true}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyDescriptor</span><span class="token punctuation">(</span>child2<span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

child1<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'newName'</span><span class="token punctuation">;</span> <span class="token comment">// 严格模式下报错</span>
child2<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'newName'</span><span class="token punctuation">;</span> <span class="token comment">// 可以赋值</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>child1<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//  Mike</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>child2<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// newName</span>
</code></pre></div><p>上面的代码通过构造函数 <code>Child</code> 构造一个对象 <code>child1</code>，这个对象的原型是 <code>Parent</code>。并且修改了 <code>child1</code> 的 <code>name</code> 属性的描述符，设置 <code>writable</code> 为 <code>false</code>，也就是这个属性不能再被修改。如果要直接给 <code>child1.name</code> 赋值，在严格模式下会报错，在非严格模式则会赋值失败（但不会报错）。</p> <p>我们调用前面提到的浅拷贝函数 <code>shallowClone</code> 来拷贝 <code>child1</code> 对象，生成了新的对象 <code>child2</code>，输出 <code>child2</code> 的 <code>name</code> 属性的描述符，我们可以发现 <code>child2</code> 的 <code>name</code> 属性的描述符与 <code>child1</code> 已经不一样了（变成了可写的）。通过开启调试模式，查看 <code>child1</code> 和 <code>child2</code> 的原型，我们也会发现它们的原型也是不同的：</p> <p><img src="http://markdown-1252710547.coscd.myqcloud.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202017-11-02%20%E4%B8%8B%E5%8D%8813.20.45%20%E4%B8%8B%E5%8D%88.png" alt=""></p> <p><code>child1</code> 的原型是 <code>Parent</code>，而 <code>child2</code> 的原型则是 <code>Object</code>。</p> <p>通过上面的例子和简短的说明，我们可以大致理解浅拷贝存在的一些问题，在实际使用过程中也能有自己的判断。</p> <h3 id="深拷贝"><a href="#深拷贝" class="header-anchor">#</a> 深拷贝</h3> <p><code>深拷贝</code>就是将对象的属性递归的拷贝到一个新的对象上，两个对象有不同的地址，不同的引用，也包括对象里的对象属性（如 object1 中的 obj 属性），两个变量之间完全独立。</p> <h3 id="没有银弹-根据实际需求"><a href="#没有银弹-根据实际需求" class="header-anchor">#</a> 没有银弹 - 根据实际需求</h3> <p>既然浅拷贝有那么多问题，我们为什么还要说浅拷贝？一来是深拷贝的完美实现不那么容易（甚至不存在），而且可能存在性能问题，二来是有些时候的确不需要深拷贝，那么我们也就没必要纠结于与深拷贝和浅拷贝了，没有必要跟自己过不去不是？</p> <p>一句话：根据自己的实际需选择不同的方法。</p> <h2 id="三，-实现对象和数组浅拷贝"><a href="#三，-实现对象和数组浅拷贝" class="header-anchor">#</a> 三， 实现对象和数组浅拷贝</h2> <h3 id="对象浅拷贝"><a href="#对象浅拷贝" class="header-anchor">#</a> 对象浅拷贝</h3> <p>前面已经介绍了对象的两种浅拷贝方式，这里就不做说明了。下面介绍其他的几种方式</p> <h4 id="_1-使用-object-assign-方法"><a href="#_1-使用-object-assign-方法" class="header-anchor">#</a> 1. 使用 Object.assign 方法</h4> <p><code>Object.assign()</code> 用于将一个或多个源对象中的所有<code>可枚举的属性</code>值复制到目标对象。<code>Object.assign()</code> 只是浅拷贝，类似上文提到的 <code>shallowClone</code> 方法。</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> object1 <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  obj<span class="token operator">:</span> <span class="token punctuation">{</span>
    b<span class="token operator">:</span> <span class="token string">'string'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 浅拷贝</span>
<span class="token keyword">var</span> copy <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> object1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 改变原对象属性</span>
object1<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
object1<span class="token punctuation">.</span>obj<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token string">'newString'</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>copy<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>copy<span class="token punctuation">.</span>obj<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// `newString`</span>
</code></pre></div><h4 id="_2-使用-object-getownpropertynames-拷贝不可枚举的属性"><a href="#_2-使用-object-getownpropertynames-拷贝不可枚举的属性" class="header-anchor">#</a> 2. 使用 Object.getOwnPropertyNames 拷贝不可枚举的属性</h4> <p><code>Object.getOwnPropertyNames()</code> 返回由对象属性组成的一个数组，包括不可枚举的属性（除了使用 Symbol 的属性）。</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">shallowCopyOwnProperties</span><span class="token punctuation">(</span> <span class="token parameter">source</span> <span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">var</span> target <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">;</span>
    <span class="token keyword">var</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyNames</span><span class="token punctuation">(</span> original <span class="token punctuation">)</span> <span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span> <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span> i <span class="token operator">&lt;</span> keys<span class="token punctuation">.</span>length <span class="token punctuation">;</span> i <span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        target<span class="token punctuation">[</span> keys<span class="token punctuation">[</span> i <span class="token punctuation">]</span> <span class="token punctuation">]</span> <span class="token operator">=</span> source<span class="token punctuation">[</span> keys<span class="token punctuation">[</span> i <span class="token punctuation">]</span> <span class="token punctuation">]</span> <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> target <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_3-使用-object-getprototypeof-和-object-getownpropertydescriptor-拷贝原型与描述符"><a href="#_3-使用-object-getprototypeof-和-object-getownpropertydescriptor-拷贝原型与描述符" class="header-anchor">#</a> 3. 使用 Object.getPrototypeOf 和 Object.getOwnPropertyDescriptor 拷贝原型与描述符</h4> <p>如果我们需要拷贝原对象的原型和描述符，我们可以使用 <code>Object.getPrototypeOf</code> 和 <code>Object.getOwnPropertyDescriptor</code> 方法分别获取原对象的原型和描述符，然后使用 <code>Object.create</code> 和 <code>Object.defineProperty</code> 方法，根据原型和属性的描述符创建新的对象和对象的属性。</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">shallowCopy</span><span class="token punctuation">(</span> <span class="token parameter">source</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 用 source 的原型创建一个对象</span>
    <span class="token keyword">var</span> target <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span> Object<span class="token punctuation">.</span><span class="token function">getPrototypeOf</span><span class="token punctuation">(</span> source <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
    <span class="token comment">// 获取对象的所有属性</span>
    <span class="token keyword">var</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyNames</span><span class="token punctuation">(</span> source <span class="token punctuation">)</span> <span class="token punctuation">;</span>
    <span class="token comment">// 循环拷贝对象的所有属性</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span> <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span> i <span class="token operator">&lt;</span> keys<span class="token punctuation">.</span>length <span class="token punctuation">;</span> i <span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 用原属性的描述符创建新的属性</span>
        Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span> target <span class="token punctuation">,</span> keys<span class="token punctuation">[</span> i <span class="token punctuation">]</span> <span class="token punctuation">,</span> Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyDescriptor</span><span class="token punctuation">(</span> source <span class="token punctuation">,</span> keys<span class="token punctuation">[</span> i <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> target <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="数组浅拷贝"><a href="#数组浅拷贝" class="header-anchor">#</a> 数组浅拷贝</h3> <p>同上，数组也可以直接复制或者遍历数组的元素直接复制达到浅拷贝的目的：</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'string'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>b<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> obj<span class="token operator">:</span> <span class="token punctuation">{</span>c<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// 直接复制</span>
<span class="token keyword">var</span> array1 <span class="token operator">=</span> array<span class="token punctuation">;</span>
<span class="token comment">// 遍历直接复制</span>
<span class="token keyword">var</span> array2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> array<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  array2<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> array<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 改变原数组元素</span>
array<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'newString'</span><span class="token punctuation">;</span>
array<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>c <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>array1<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// newString</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>array1<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 4</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>array2<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// string</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>array2<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 4</span>
</code></pre></div><p>这没有什么需要特别说明的，我们说些其他方法</p> <h4 id="使用-slice-和-concat-方法"><a href="#使用-slice-和-concat-方法" class="header-anchor">#</a> 使用 slice 和 concat 方法</h4> <p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/slice" target="_blank" rel="noopener noreferrer"><code>slice()</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 方法将一个数组被选择的部分（默认情况下是全部元素）浅拷贝到一个新数组对象，并返回这个数组对象，原始数组不会被修改。 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/concat?v=a" target="_blank" rel="noopener noreferrer"><code>concat()</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 方法用于合并两个或多个数组。此方法不会更改现有数组，而是返回一个新数组。</p> <p>这两个方法都可以达到拷贝数组的目的，并且是浅拷贝，数组中的对象只是复制了引用：</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'string'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>b<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> obj<span class="token operator">:</span> <span class="token punctuation">{</span>c<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// slice()</span>
<span class="token keyword">var</span> array1 <span class="token operator">=</span> array<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// concat()</span>
<span class="token keyword">var</span> array2 <span class="token operator">=</span> array<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 改变原数组元素</span>
array<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'newString'</span><span class="token punctuation">;</span>
array<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>c <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>array1<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// string</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>array1<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 4</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>array2<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// string</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>array2<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 4</span>
</code></pre></div><h2 id="四，-实现对象和数组深拷贝"><a href="#四，-实现对象和数组深拷贝" class="header-anchor">#</a> 四， 实现对象和数组深拷贝</h2> <p>实现深拷贝的方法大致有两种：</p> <ul><li>利用 <code>JSON.stringify</code> 和 <code>JSON.parse</code> 方法</li> <li>遍历对象的属性（或数组的元素），分别拷贝</li></ul> <p>下面就两种方法详细说说</p> <h4 id="_1-使用-json-stringify-和-json-parse-方法"><a href="#_1-使用-json-stringify-和-json-parse-方法" class="header-anchor">#</a> 1. 使用 JSON.stringify 和 JSON.parse 方法</h4> <p><code>JSON.stringify</code>和<code>JSON.parse</code> 是 JavaScript 内置对象 JSON 的两个方法，主要是用来将 JavaScript 对象序列化为 JSON 字符串和把 JSON 字符串解析为原生 JavaScript 值。这里被用来实现对象的拷贝也算是一种黑魔法吧：</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token punctuation">{</span> c<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 深拷贝</span>
<span class="token keyword">var</span> newObj <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 改变原对象的属性</span>
obj<span class="token punctuation">.</span>b<span class="token punctuation">.</span>c <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { a: 1, b: { c: 20 } }</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newObj<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { a: 1, b: { c: 2 } }</span>
</code></pre></div><p>但是这种方式有一定的局限性，就是对象必须遵从JSON的格式，当遇到层级较深，且序列化对象不完全符合JSON格式时，使用JSON的方式进行深拷贝就会出现问题。</p> <p>在序列化 JavaScript 对象时，所有<code>函数及原型成员</code>都会被有意忽略，不体现在结果中，也就是说这种方法不能拷贝对象中的函数。此外，值为 undefined 的任何属性也都会被跳过。结果中最终都是值为有效 JSON 数据类型的实例属性。</p> <h4 id="_2-使用递归"><a href="#_2-使用递归" class="header-anchor">#</a> 2. 使用递归</h4> <p>递归是一种常见的解决这种问题的方法：我么可以定义一个函数，遍历对象的属性，当对象的属性是基本类型值得时候，直接拷贝；当属性是引用类型值的时候，再次调用这个函数进行递归拷贝。这是基本的思想，下面看具体的实现（不考虑原型，描述符，不可枚举属性等，便于理解）：</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">deepClone</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 递归终止条件</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>source <span class="token operator">||</span> <span class="token keyword">typeof</span> source <span class="token operator">!==</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> source<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">var</span> targetObj <span class="token operator">=</span> source<span class="token punctuation">.</span>constructor <span class="token operator">===</span> Array <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> source<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token parameter">source<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>source<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> source<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        targetObj<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">deepClone</span><span class="token punctuation">(</span>source<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        targetObj<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> source<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> targetObj<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> object1 <span class="token operator">=</span> <span class="token punctuation">{</span>arr<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> obj<span class="token operator">:</span> <span class="token punctuation">{</span>key<span class="token operator">:</span> <span class="token string">'value'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token function-variable function">func</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 深拷贝</span>
<span class="token keyword">var</span> newObj<span class="token operator">=</span> <span class="token function">deepClone</span><span class="token punctuation">(</span>object1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 改变原对象属性</span>
object1<span class="token punctuation">.</span>arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>object1<span class="token punctuation">.</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [1, 2, 3, 4]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newObj<span class="token punctuation">.</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [1, 2, 3]</span>
</code></pre></div><p>对于 Function 类型，这里是直接复制的，任然是共享一个内存地址。因为函数更多的是完成某些功能，对函数的更改可能就是直接重新赋值，一般情况下不考虑深拷贝。</p> <p>上面的深拷贝只是比较简单的实现，没有考虑很复杂的情况，比如：</p> <ul><li>其他引用类型：Function，Date，RegExp 的拷贝</li> <li>对象中存在循环引用(Circular references)会导致调用栈溢出</li> <li>通过闭包作用域来实现私有成员的这类对象不能真正的被拷贝</li></ul> <p><strong>什么是闭包作用域</strong></p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">myConstructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">var</span> myPrivateVar <span class="token operator">=</span> <span class="token string">'secret'</span> <span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        myPublicVar<span class="token operator">:</span> <span class="token string">'public!'</span> <span class="token punctuation">,</span>
        <span class="token function-variable function">getMyPrivateVar</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> myPrivateVar <span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token punctuation">,</span>
        <span class="token function">setMyPrivateVar</span><span class="token punctuation">(</span> <span class="token parameter">value</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
            myPrivateVar <span class="token operator">=</span> value<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token function">myContructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
</code></pre></div><p>上面的代码中，对象 o 有三个属性，一个是字符串，另外两个是方法。方法中用到一个变量 <code>myPrivateVar</code>，存在于 <code>myConstructor()</code> 的函数作用域中，当 <code>myConstructor</code> 构造函数调用时，就创建了这个变量 <code>myPrivateVar</code>，然而这个变量并不是通过构造函数创建的对象 <code>o</code> 的属性，但是它任然可以被这两个方法使用。</p> <p>因此，如果尝试深拷贝对象 <code>o</code>，那么拷贝对象 <code>clone</code> 和被拷贝对象 <code>original</code> 中的方法都是引用相同的 <code>myPrivateVar</code> 变量。</p> <p>但是，由于并没有方式改变闭包的作用域，所以这种模式创建的对象不能正常深拷贝是可以接受的。</p> <h4 id="_3-使用队列"><a href="#_3-使用队列" class="header-anchor">#</a> 3. 使用队列</h4> <p>递归的做法虽然简单，容易理解，但是存在一定的性能问题，对拷贝比较大的对象来说不是很好的选择。</p> <p>理论上来说，递归是可以转化成循环的，我们可以尝试着将深拷贝中的递归转化成循环。我们需要遍历对象的属性，如果属性是基本类型，直接复制，如果属性是引用类型（对象或数组），需要再遍历这个对象，对他的属性进行相同的操作。那么我们需要一个容器来存放需要进行遍历的对象，每次从容器中拿出一个对象进行拷贝处理，如果处理过程中遇到新的对象，那么再把它放到这个容器中准备进行下一轮的处理，当把容器中所有的对象都处理完成后，也就完成了对象的拷贝。</p> <p>思想大致是这样的，下面看具体的实现：</p> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token comment">// 利用队列的思想优化递归</span>
<span class="token keyword">function</span> <span class="token function">deepClone</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>source <span class="token operator">||</span> <span class="token keyword">typeof</span> source <span class="token operator">!==</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> source<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">var</span> current<span class="token punctuation">;</span>
  <span class="token keyword">var</span> target <span class="token operator">=</span> source<span class="token punctuation">.</span>constructor <span class="token operator">===</span> Array <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token comment">// 用数组作为容器</span>
  <span class="token comment">// 记录被拷贝的原对象和目标</span>
  <span class="token keyword">var</span> cloneQueue <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    source<span class="token punctuation">,</span>
    target
  <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">// 先进先出，更接近于递归</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>current <span class="token operator">=</span> cloneQueue<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> current<span class="token punctuation">.</span>source<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>current<span class="token punctuation">.</span>source<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>current<span class="token punctuation">.</span>source<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> current<span class="token punctuation">.</span>source<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          current<span class="token punctuation">.</span>target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> current<span class="token punctuation">.</span>source<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span>constructor <span class="token operator">===</span> Array <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
          cloneQueue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            source<span class="token operator">:</span> current<span class="token punctuation">.</span>source<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span>
            target<span class="token operator">:</span> current<span class="token punctuation">.</span>target<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          current<span class="token punctuation">.</span>target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> current<span class="token punctuation">.</span>source<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> target<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> object1 <span class="token operator">=</span> <span class="token punctuation">{</span>a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token punctuation">{</span>c<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> d<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> object2 <span class="token operator">=</span> <span class="token function">deepClone</span><span class="token punctuation">(</span>object1<span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>object2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {a: 1, b: {c: 2, d: 3}}</span>
</code></pre></div><p>（完）</p> <h3 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h3> <ol><li>《JavaScript 高级程序设计》</li> <li><a href="https://segmentfault.com/a/1190000008637489" target="_blank" rel="noopener noreferrer">JavaScript中的浅拷贝和深拷贝<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://objcer.com/2017/02/27/Dive-into-shallow-and-deep-clone-in-JavaScript/" target="_blank" rel="noopener noreferrer">探究 JS 中的浅拷贝和深拷贝<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://blog.soulserv.net/understanding-object-cloning-in-javascript-part-i/" target="_blank" rel="noopener noreferrer">Understanding Object Cloning in Javascript - Part. I<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://blog.soulserv.net/understanding-object-cloning-in-javascript-part-ii/" target="_blank" rel="noopener noreferrer">Understanding Object Cloning in Javascript - Part. II<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ol></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2019-03-29 07:01:41</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/the-full-stack-way/assets/js/app.f9357a35.js" defer></script><script src="/the-full-stack-way/assets/js/2.b1f3daca.js" defer></script><script src="/the-full-stack-way/assets/js/54.0686f57d.js" defer></script>
  </body>
</html>
