# webpack å…¥é—¨ä¸€

## ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ webpack

æ—¢ç„¶ä½ åœ¨çœ‹è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ç›¸ä¿¡ä½ å¯¹ webpack å·²ç»æœ‰æ‰€è€³é—»ï¼Œå¯¹ webpack çš„ä½œç”¨ä¹Ÿæœ‰ä¸€ç‚¹ç†è§£ï¼Œä¸çŸ¥é“ ğŸ¤”ï¼Ÿæ²¡å…³ç³»ï¼Œä¸”å¬æˆ‘æ…¢æ…¢é“æ¥...

åœ¨ web å¼€å‘è¿™ç‰‡å¤§åœ°ä¸Šï¼Œæ— æ•°å‰è¾ˆæµ´è¡€å¥‹æˆ˜ï¼Œå¼€è¾Ÿç–†åœŸï¼Œæ‰©å¤§ç€é¢†åœŸèŒƒå›´ã€‚éšç€æ—¶é—´çš„å‘å±•ï¼Œweb å¼€å‘ä¸å†æ˜¯ç®€å•çš„é¡µé¢ï¼Œè€Œæ˜¯æ¸æ¸å¾€åº”ç”¨çš„æ–¹å‘å‘å±•ã€‚å®ƒä»¬æ‹¥æœ‰ç€å¤æ‚çš„ JavaScript ä»£ç å’Œä¸€å¤§å †ä¾èµ–ï¼Œä»£ç ä¹‹é—´çš„å…³ç³»å˜å¾—è¶Šæ¥å¤æ‚ï¼Œä¼ ç»Ÿçš„å¼€å‘ã€æ–‡ä»¶ç®¡ç†æ–¹å¼å˜å¾—åŠ›ä¸ä»å¿ƒï¼Œä¸ºäº†ç®€åŒ–å¼€å‘çš„å¤æ‚åº¦ï¼Œå‰ç«¯ç¤¾åŒºæ¶Œç°å‡ºäº†å¾ˆå¤šå¥½çš„å®è·µæ–¹æ³•ï¼š

* æ¨¡å—åŒ–ï¼šä¸€ä¸ªæ–‡ä»¶å¤ªå¤§ï¼Œå°±æŠŠæ–‡ä»¶åˆ†å¼€ã€‚ä¸€ä¸ªåŠŸèƒ½å¤ªå¤æ‚ï¼Œå°±æŠŠåŠŸèƒ½æ‹†åˆ†å®ç°ã€‚è¿™æ ·å¯ä»¥æŠŠå¤æ‚çš„ç¨‹åºç»†åŒ–ä¸ºå°çš„æ–‡ä»¶ï¼Œå†™ä»£ç ä¹Ÿå°±å˜æˆäº†æ­ç§¯æœ¨çš„æ–¹å¼ï¼Œå¤§å¤§ç®€åŒ–äº†å¼€å‘éš¾åº¦ã€‚
* ç±»ä¼¼äº Babel è¿™ç§ç¼–è¯‘å™¨ï¼Œå¯ä»¥è®©æˆ‘ä»¬æå‰äº«å—æ–°çš„ JavaScript è¯­æ³•ã€‚
* Sassï¼ŒLess ç­‰ CSS é¢„å¤„ç†å™¨ï¼Œèµ‹äºˆäº† CSS ä¸€å®šçš„ç¼–ç¨‹èƒ½åŠ›ã€‚
* ...

è¿™äº›æ”¹è¿›ç¡®å®å¤§å¤§çš„æé«˜äº†æˆ‘ä»¬çš„å¼€å‘æ•ˆç‡ï¼Œä½†æ˜¯åˆ©ç”¨å®ƒä»¬å¼€å‘çš„æ–‡ä»¶å¾€å¾€éœ€è¦è¿›è¡Œé¢å¤–çš„å¤„ç†æ‰èƒ½è®©æµè§ˆå™¨è¯†åˆ«, è€Œæ‰‹åŠ¨å¤„ç†åˆæ˜¯éå¸¸ç¹ççš„ï¼Œè¿™å°±ä¸º webpack ç±»çš„å·¥å…·çš„å‡ºç°æä¾›äº†éœ€æ±‚ã€‚

## webpack æ˜¯ä»€ä¹ˆ ğŸ¤”

![demo](./pics/1-1.png)

> æœ¬è´¨ä¸Šï¼Œwebpack æ˜¯ä¸€ä¸ªç°ä»£ JavaScript åº”ç”¨ç¨‹åºçš„é™æ€æ¨¡å—æ‰“åŒ…å™¨ (module bundler)ã€‚å½“ webpack å¤„ç†åº”ç”¨ç¨‹åºæ—¶ï¼Œå®ƒä¼šé€’å½’åœ°æ„å»ºä¸€ä¸ªä¾èµ–å…³ç³»å›¾ (dependency graph)ï¼Œå…¶ä¸­åŒ…å«åº”ç”¨ç¨‹åºéœ€è¦çš„æ¯ä¸ªæ¨¡å—ï¼Œç„¶åå°†æ‰€æœ‰è¿™äº›æ¨¡å—æ‰“åŒ…æˆä¸€ä¸ªæˆ–å¤šä¸ª bundleã€‚

ä»å®˜ç½‘çš„ä»‹ç»ä¸­ï¼Œ æˆ‘ä»¬å¯ä»¥çœ‹å‡º webpack  åšçš„äº‹æƒ…å¾ˆç®€å•ï¼šåˆ†æå¹¶å¤„ç†åº”ç”¨ç¨‹åºæ¨¡å—ä¹‹é—´çš„ä¾èµ–ï¼Œç„¶åå°†åº”ç”¨ç¨‹åºéœ€è¦çš„æ¯ä¸ªæ¨¡å—æ‰“åŒ…æˆä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶ã€‚

webpack è¦å¤„ç†æ¨¡å—ä¹‹é—´çš„ä¾èµ–ï¼Œå¯æ˜¯æ€ä¹ˆå¤„ç†å‘¢ï¼Œå®ƒæ€ä¹ˆçŸ¥é“ä»å“ªé‡Œå¼€å§‹å‘¢ï¼Œå¤„ç†å®Œä¹‹åå‘¢ï¼Ÿæ€ä¹ˆå¤„ç†å‘¢ï¼Ÿè¿™å°±éœ€è¦æˆ‘ä»¬æŒ‡å®šé¡¹ç›®çš„å…¥å£ (entry)ï¼Œæ‰“åŒ…å®Œæˆåçš„æ–‡ä»¶æ”¾åˆ°å“ªé‡Œï¼Œä¹Ÿå°±æ˜¯å‡ºå£ (output)ï¼Œä»¥åŠå¤„ç†æ‰“åŒ…çš„è¿‡ç¨‹ (loader, plugins)ã€‚

ğŸ˜ ç°åœ¨æˆ‘ä»¬å·²ç»ç†è§£äº† webpack çš„åŠŸèƒ½äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¼€å§‹å°è¯•ä½¿ç”¨ webpack å§ï¼

## [webpack å®‰è£…](https://doc.webpack-china.org/guides/installation#local-installation) âš™

> åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿å®‰è£…äº† Node.js çš„æœ€æ–°ç‰ˆæœ¬ä»¥åŠ yarn æˆ–è€… npmã€‚

æ–°å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œ æ‰§è¡Œä¸‹é¢å‘½ä»¤å®‰è£… webpackã€‚

```shell
# æœ¬åœ°å®‰è£…
yarn add webpack webpack-cli

# å…¨å±€å®‰è£…ï¼ˆä¸€èˆ¬æƒ…å†µä¸‹ä¸å»ºè®®ä½¿ç”¨ï¼‰
# yarn global add webpack
```

### ğŸ“ æ³¨æ„ï¼šå¦‚æœä¸åœ¨å‘½ä»¤è¡Œä½¿ç”¨ webpackï¼Œå¯ä»¥ä¸å®‰è£… `webpack-cli`ã€‚

## ç®€å•ä½¿ç”¨ webpack ğŸŒ°

### åˆ›å»ºæµ‹è¯•æ–‡ä»¶

é¦–å…ˆæˆ‘ä»¬è¦åˆ›å»ºä¸€äº›æ–‡ä»¶æ¥è¿›è¡Œæµ‹è¯•ï¼šåˆ›å»º src ç›®å½•ï¼Œåœ¨ src ç›®å½•ä¸‹æ–°å»º `main.js`ã€`greet.js` æ–‡ä»¶ï¼Œåˆ›å»º dist ç›®å½•ï¼Œåœ¨ dist ç›®å½•ä¸‹åˆ›å»º `index.html` æ–‡ä»¶ã€‚

> dist é€šå¸¸æ˜¯ä»£ç æ‰“åŒ…åè¾“å‡ºçš„åœ°æ–¹ã€‚

greet.js

```JavaScript
module.exports = function() {
  var greet = document.createElement('div');
  greet.innerText = 'hello webpack';
  return greet;
};
```

main.js

```JavaScript
const greet = require('./greet');
document.querySelector('#root').appendChild(greet());
```

index.html

```HTML
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>webpack test</title>
</head>
<body>
  <div id="root">
  </div>
  <script src="./bundle.js"></script>
</body>
</html>
```

æ–‡ä»¶åˆ›å»ºå®Œæˆåï¼Œå°±å¯ä»¥å¼€å§‹æ‰“åŒ… (bundle) æµ‹è¯•äº†ã€‚webpack å¯ä»¥åœ¨ç»ˆç«¯ä¸­ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨é…ç½®æ–‡ä»¶ã€‚

### åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨ webpack

å‘½ä»¤è¡Œä¸­çš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š

```shell
# å…¨å±€æ¨¡å¼ä¸‹å¯ä»¥ç›´æ¥ä½¿ç”¨ webpack
# æœ¬åœ°æ¨¡å¼ä¸‹ä½¿ç”¨ node_modules ä¸‹çš„ webpack å‘½ä»¤
webpack {entry file} --output {destination for bundled file}

./node_modules/.bin/webpack {entry file} --output {destination for bundled file}
```

è¿è¡Œ webpack æ‰“åŒ…å‘½ä»¤ï¼š

```shell
# Node 8.2+ ç‰ˆæœ¬æä¾›çš„ npx å‘½ä»¤ï¼Œå¯ä»¥è¿è¡Œåœ¨åˆå§‹å®‰è£…çš„ webpack åŒ… (package) çš„ webpack äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆ./node_modules/.bin/webpackï¼‰

npx webpack src/main.js --output dist/bundle.js
```

å¯ä»¥çœ‹åˆ°ä¸‹é¢ç±»ä¼¼çš„ç»“æœ ğŸ‘‡

![demo](./pics/1-2.png)

æ­å–œ ğŸ‰ï¼Œä½ å·²ç»æˆåŠŸçš„ä½¿ç”¨ webpack æ‰“åŒ…äº†ä¸€ä¸ªæ–‡ä»¶äº†ã€‚ä¸è¿‡åœ¨å‘½ä»¤è¡Œè¿›è¡Œå¤æ‚çš„æ“ä½œè¿˜æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ï¼Œå¤§å¤šæ•°é¡¹ç›®ä¼šéœ€è¦å¾ˆå¤æ‚çš„è®¾ç½®ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ webpack çš„é…ç½®æ–‡ä»¶æ–¹æ³•è¿›è¡Œæ‰“åŒ…ï¼Œè¿™æ¯”åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥å¤§é‡å‘½ä»¤è¦é«˜æ•ˆçš„å¤šã€‚

### ä½¿ç”¨é…ç½®æ–‡ä»¶

æˆ‘ä»¬æ–°å»ºä¸€ä¸ª `webpack.config.js` æ–‡ä»¶ï¼Œåœ¨æ­¤æ–‡ä»¶ä¸­å†™å…¥å¦‚ä¸‹å†…å®¹ï¼š

```JavaScript
const path = require('path');

const config = {
  // æ‰“åŒ…çš„å…¥å£æ–‡ä»¶
  entry: './src/index.js',
  // æ‰“åŒ…çš„å‡ºå£æ–‡ä»¶
  output: {
    filename: 'bundle.js',
    path: path.resolve(__dirname, 'dist')
  }
};

// éœ€è¦å¯¼å‡ºé…ç½®ï¼Œä¸”ä¸èƒ½ä½¿ç”¨ es6 çš„ export
module.exports = config;
```

### ğŸ“ NOTEï¼š`__dirname` æ˜¯ node.js ä¸­çš„ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œå®ƒæŒ‡å‘å½“å‰æ‰§è¡Œè„šæœ¬æ‰€åœ¨çš„ç›®å½•ã€‚

æœ‰äº†è¿™ä¸ªé…ç½®ä¹‹åï¼Œå†æ‰“åŒ…æ–‡ä»¶ï¼Œåªéœ€åœ¨ç»ˆç«¯é‡Œè¿è¡Œ webpack(éå…¨å±€å®‰è£…éœ€ä½¿ç”¨ node_modules/.bin/webpack) å‘½ä»¤å°±å¯ä»¥äº†ï¼Œè¿™æ¡å‘½ä»¤ä¼šè‡ªåŠ¨å¼•ç”¨ webpack.config.js æ–‡ä»¶ä¸­çš„é…ç½®é€‰é¡¹ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š

```shell
./node_modules/.bin/webpack
# æˆ–è€…
npx webpack
```

å¾—åˆ°çš„ç»“æœå¦‚ä¸‹ï¼š

![demo](./pics/1-3.png)

### NPM è„šæœ¬ - æ›´å¿«æ·çš„æ‰§è¡Œæ‰“åŒ…ä»»åŠ¡

ç”¨å‘½ä»¤è¡Œæ‰§è¡Œè¿™ç§æ–¹å¼æ¥è¿è¡Œæœ¬åœ°çš„ webpack å¹¶ä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼Œå€¼å¾—åº†å¹¸çš„æ˜¯ NPM å¯ä»¥å¼•å¯¼ä»»åŠ¡æ‰§è¡Œï¼Œå¯¹ NPM è¿›è¡Œé…ç½®åå¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨ç®€å•çš„ `yarn run build` å‘½ä»¤æ¥æ›¿ä»£ä¸Šé¢ç•¥å¾®ç¹ççš„å‘½ä»¤ã€‚åœ¨ `package.json` ä¸­å¯¹ scripts å¯¹è±¡è¿›è¡Œç›¸å…³è®¾ç½®å³å¯ï¼Œè®¾ç½®æ–¹æ³•å¦‚ä¸‹ï¼š

```json
{
  "name": "webpack-test",
  "version": "1.0.0",
  "main": "index.js",
  "license": "null",
  "scripts": {
    "build": "webpack"
  },
  "dependencies": {
    "webpack": "^4.1.1",
    "webpack-cli": "^2.0.12"
  }
}
```

ç„¶åæˆ‘ä»¬ç›´æ¥åœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œ `yarn run build` å³å¯å¯¹æ–‡ä»¶è¿›è¡Œæ‰“åŒ…ï¼Œç»“æœæˆ‘å°±ä¸åˆ—äº†ï¼Œå’Œå‰é¢çš„ç»“æœç±»ä¼¼ã€‚

ç»†å¿ƒçš„è¯»è€…å¯èƒ½æ³¨æ„åˆ°äº†ï¼Œæˆ‘ä»¬è¿™é‡Œå¹¶æ²¡æœ‰æŒ‡å®š webpack çš„è·¯å¾„ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ

#### ğŸ“ NOTE: `package.json` ä¸­çš„ `scripts` ä¼šå®‰è£…ä¸€å®šé¡ºåºå¯»æ‰¾å‘½ä»¤å¯¹åº”ä½ç½®ï¼Œæœ¬åœ°çš„ `node_modules/.bin` è·¯å¾„å°±åœ¨è¿™ä¸ªå¯»æ‰¾æ¸…å•ä¸­ï¼Œæ‰€ä»¥æ— è®ºæ˜¯å…¨å±€è¿˜æ˜¯å±€éƒ¨å®‰è£…çš„ webpackï¼Œä½ éƒ½ä¸éœ€è¦å†™å‰é¢é‚£æŒ‡æ˜è¯¦ç»†çš„è·¯å¾„äº†ã€‚

å…³äº npm scripts çš„æ›´å¤šå†…å®¹å¯ä»¥å‚è€ƒ [npm scripts ä½¿ç”¨æŒ‡å—](http://www.ruanyifeng.com/blog/2016/10/npm_scripts.html)ã€‚

æ˜¯ä¸æ˜¯è§‰å¾— webpack ä¼¼ä¹ä¹Ÿæ²¡æœ‰é‚£ä¹ˆéš¾ï¼Ÿä¸è¿‡ä¹Ÿä¸èƒ½è½»è§† webpackï¼Œä¸Šé¢åªæ˜¯ç®€å•çš„ä½¿ç”¨ webpackï¼Œä¸‹é¢æˆ‘ä»¬å°†ä»‹ç» webpack æ›´å¤šçš„ç¥å¥‡åŠŸèƒ½ï¼

ä¸‹ä¸€ç¯‡æ–‡ç«  â¡ [webpack å…¥é—¨äºŒ](./webpack_2.md)

### å‚è€ƒæ–‡ç«  ğŸ“–

* [å…¥é—¨ Webpackï¼Œçœ‹è¿™ç¯‡å°±å¤Ÿäº†](https://segmentfault.com/a/1190000006178770#articleHeader3)
* [å®˜æ–¹æ–‡æ¡£](https://doc.webpack-china.org/guides/getting-started/)