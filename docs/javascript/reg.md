---
id: reg
title: 正则表达式
---

在编写处理字符串的程序或网页时，经常会有查找符合某些复杂规则的字符串的需要。正则表达式就是用于描述这些规则的工具。换句话说，正则表达式就是记录文本规则的代码。

正则表达式是被用来匹配字符串中的字符组合的模式。在 JavaScript 中，正则表达式也是对象。这种模式可以被用于 RegExp 的 exec 和 test 方法以及 String 的 match、replace、search 和 split 方法。

## 元字符

| 元字符 |                               说明                                |
| :----: | :---------------------------------------------------------------: |
|   .    |                    匹配除换行符以外的任意字符                     |
|   \d   |                    匹配数字字符 (等价于 [0-9])                    |
|   \w   | 任何一个字母数字字符 (大小写均可) 或下划线（等价于 [a-zA-Z0-9_]） |
|   \s   |              任何一个空白字符 (等价于 [\f\n\r\t\v])               |
|   \W   |      任何一个非字母数字或非下划线字符 (等价于 [^a-za-z0-9_])      |
|   \S   |             任何一个非空白字符 (等价于 [^\f\n\r\t\v])             |
|   \D   |                  匹配非数字字符 (等价于 [^0-9])                   |
|   \B   |                   匹配不是单词开头或结束的位置                    |

## 重复匹配

正则表达式中所有的限定符：

| 代码 / 语法 | 说明              |
| ----------- | ----------------- |
| \*          | 重复零次或更多次  |
| +           | 重复一次或更多次  |
| ?           | 重复零次或一次    |
| {n}         | 重复 n 次         |
| {n,}        | 重复 n 次或更多次 |
| {n,m}       | 重复 n 到 m 次    |

- `Windows\d+` 匹配 Windows 后面跟 1 个或更多数字

- `a+` 匹配一个或多个连续出现的 a

## 贪婪与懒惰

当正则表达式中包含能接受重复的限定符时，通常的行为是（在使整个表达式能得到匹配的前提下）匹配尽可能多的字符。以这个表达式为例：`a.*b`，它将会匹配最长的以 a 开始，以 b 结束的字符串。如果用它来搜索 aabab 的话，它会匹配整个字符串 aabab，这被称为贪婪匹配。

有时，我们更需要懒惰匹配，也就是匹配尽可能少的字符。前面给出的限定符都可以被转化为懒惰匹配模式，只要在它后面加上一个问号 `?` 。这样 `.*?` 就意味着匹配任意数量的重复，但是在能使整个匹配成功的前提下使用最少的重复。现在看看懒惰版的例子吧：

`a.*?b` 匹配最短的，以 a 开始，以 b 结束的字符串。如果把它应用于 aabab 的话，它会匹配 aab（第一到第三个字符）和 ab（第四到第五个字符）。

| 代码 / 语法 | 说明                              |
| ----------- | --------------------------------- |
| \*?         | 重复任意次，但尽可能少重复        |
| +?          | 重复 1 次或更多次，但尽可能少重复 |
| ??          | 重复 0 次或 1 次，但尽可能少重复  |
| {n,m}?      | 重复 n 到 m 次，但尽可能少重复    |
| {n,}?       | 重复 n 次以上，但尽可能少重复     |

## 位置匹配

`\b`：boundary。 简单的说 `\b` 匹配的是一个这样的位置，这个位置位于一个能够用来构成单词的字符（字母、数字和下划线，也就是 `\w` 相匹配的字符）和一个不能用来构成单词的字符 (也就是跟 `\W` 相匹配的字符) 之间。需要注意一点的是 `\b` 只匹配位置，不匹配字符也就是不占用匹配出来的字符的长度。`\bcat\b` 匹配出来的字符长度就是 `3` 而不是 `5`.

`\B` 同理，`\B` 则是匹配一个不是单词边界的连字符。举个栗子吧：

```source-shell
var a1 = 'Please enter the nine-digit id as it appears on your color - coded pass-key';
```

我现在要匹配 `-`，仔细的同学已经发现这三个 `-` 可以分成两类，第一类是直接与 `\w` 仅仅相邻，如 `pass-key`，暂记作类型 1 吧，另一种是不与其相邻 `color - coded` 以空格相邻，类型 2。假如我要匹配类型 2，那么正则表达式就应该这样写:

```source-shell
/\B-\B/g
```

匹配类型 1 的 `-`，应该这样写：

```source-shell
/\b-\b/g
```

大家可以在 console 里面粘贴测试效果，代码如下：

```source-shell
var a1 = 'Please enter the nine-digit id as it appears on your color - coded pass-key';
a1.match(/\B-\B/g);
a1.match(/\b-\b/g);
```

## 子表达式

我们已经提到了怎么重复单个字符（直接在字符后面加上限定符就行了），如果想要重复多个字符又该怎么办？你可以用小括号来指定子表达式 (也叫做分组)，然后你就可以指定这个子表达式的重复次数了，你也可以对子表达式进行其它一些操作。

`(\d{1,3}\.){3}\d{1,3}` 是一个简单的 IP 地址匹配表达式。要理解这个表达式，请按下列顺序分析它：`\d{1,3}` 匹配 1 到 3 位的数字，`(\d{1,3}\.){3}` 匹配三位数字加上一个英文句号 (这个整体也就是这个分组) 重复 3 次，最后再加上一个一到三位的数字 `(\d{1,3})`。

此外，子表达式还允许嵌套。事实上，子表达式允许多重嵌套，这种嵌套的层次在理论上没有限制，但在实际工作中还是应该遵循适可而止的原则。

## 分枝条件

正则表达式里的分枝条件指的是有几种规则，如果满足其中任意一种规则都应该当成匹配，具体方法是用 | 把不同的规则分隔开。

`0\d{2}-\d{8}|0\d{3}-\d{7}` 这个表达式能匹配两种以连字号分隔的电话号码：一种是三位区号，8 位本地号 (如 010-12345678)，一种是 4 位区号，7 位本地号 (0376-2233445)。

## 向前查找

向前查找制定了一个必须匹配但不在结果中返回的模式。向前查找实际就是一个子表达式，而且从格式上也确实如此。从语法上看，一个向前查找模式其实就是一个以`?=`开头的子表达式，需要匹配的文本跟在`=`的后面。

> `提示` 有些正则表达式文档使用术语`"消费"`来表述`匹配和返回文本`的含义。在向前查找里，被匹配的文本不包含在最终返回的匹配结果里面，这被称为`不消费`。

栗子一颗：比如我要查找下面文本中所有的协议名称

```source-shell
http://www.yonyouhr.com
https://www.yonyouhr.com
ftp://123.109.12.12
```

那么正则表达式就应该类似这样写：

```source-shell
/(\w+(?=:))/g
```

这样匹配出来的就是不带有`:`的协议文本。

俗话说的好，凡事都有两性性，既然有了`=`那自然也会有`!`。举个栗子：我们要匹配下面这个语句中的 “<” 后面不是 “br>” 的 “<”：

```source-shell
<div>line1</div> <br>
```

那么正则表达式就该这样写：

```source-shell
/<(?!br>)/
```

## 参考文章

- [正则表达式 30 分钟入门教程](http://www.jb51.net/tools/zhengze.html)
- [JavaScript 学习之正则表达式](https://github.com/HRFE/blog/issues/8)
- [玩转 JavaScript 正则表达式](http://imweb.io/topic/56e804ef1a5f05dc50643106)
- [JavaScript 正则进阶之路——活学妙用奇淫正则表达式](https://github.com/jawil/blog/issues/20)
- [JavaScript 正则表达式备忘单](https://juejin.im/post/5c7496fdf265da2dda6957d2)
